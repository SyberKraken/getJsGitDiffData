<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>

<!-- Create a div where the graph will take place -->
<div id="my_dataviz" style="width: 100%; height: 100vh;"></div>
<script>

   // set the dimensions and margins of the graph
  var margin = {top: 0, right: 0, bottom: 0, left: 0},
  width = 1920 - margin.left - margin.right,
  height = 1080 - margin.top - margin.bottom;
    
    // append the svg object to the body of the page
    var svg = d3.select("#my_dataviz")
    .append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
    .append("g")
      .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");
    
    // read json data
    let params = new Proxy(new URLSearchParams(window.location.search),{get:(searchParams, prop) => searchParams.get(prop),});
    let file_to_show = params.file;
    d3.json("http://localhost:5500/" + file_to_show, function(data) {
    
     // Give the data to this cluster layout:
  var root = d3.hierarchy(data).sum(function(d){ return d.value}) // Here the size of each leave is given in the 'value' field in input data

// Then d3.treemap computes the position of each element of the hierarchy
d3.treemap()
  .size([width, height])
  .paddingTop(0)
  .paddingRight(0)
  .paddingInner(0)      // Padding between each rectangle
  .paddingOuter(0)
  .padding(0)
  (root)

// prepare a color scale
var color = d3.scaleOrdinal()
  .domain(["boss1", "boss2", "boss3"])
  .range([ "#402D54", "#D18975", "#8F0175", "#199073", "#880000", "#008800","#000088","#555555"])

// And an opacity scale
var opacity = d3.scaleLinear()
  .domain([0, 30])
  .range([.5,1])

// use this information to add rectangles:
svg
  .selectAll("rect")
  .data(root.leaves())
  .enter()
  .append("rect")
    .attr('x', function (d) { return d.x0; })
    .attr('y', function (d) { return d.y0; })
    .attr('width', function (d) { return d.x1 - d.x0; })
    .attr('height', function (d) { return d.y1 - d.y0; })
    .style("stroke", "black")
    .style("fill", function(d){ return color(d.parent.data.name)} )
    .style("opacity", function(d){ return opacity(d.data.value)})


// and to add the text labels
svg
  .selectAll("text")
  .data(root.leaves())
  .enter()
  .append("text")
    .attr("x", function(d){ return d.x0 +5})    // +10 to adjust position (more right)
    .attr("y", function(d){return d.y0 + 40})    // +20 to adjust position (lower)
    .text(function(d){ return d.data.name})
    .attr("font-size", function(d){if(d.data.name.length > 15){return "15px"}else{return "23px"}})
    .attr("fill", "white")

// and to add the text labels
svg
  .selectAll("vals")
  .data(root.leaves())
  .enter()
  .append("text")
    .attr("x", function(d){ return d.x0+5})    // +10 to adjust position (more right)
    .attr("y", function(d){ return d.y0+15})    // +20 to adjust position (lower)
    .text(function(d){ return d.data.group })
    .attr("font-size", "8px")
    .attr("fill", "white")

// Add title for the 3 groups
/* svg
  .selectAll("titles")
  .data(root.descendants().filter(function(d){return d.depth==1}))
  .enter()
  .append("text")
    .attr("x", function(d){ return d.x0})
    .attr("y", function(d){ return d.y0+21})
    .text(function(d){ return d.data.name })
    .attr("font-size", "19px")
    .attr("fill",  function(d){ return color(d.data.name)} )
 */
// Add title for the 3 groups
/* svg
  .append("text")
    .attr("x", 0)
    .attr("y", 14)    // +20 to adjust position (lower)
    .text("Files")
    .attr("font-size", "19px")
    .attr("fill",  "grey" )
 */
})
</script>